<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistique Spatiale</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Orbitron', 'Arial', sans-serif;
            color: #fff;
            background-color: #000;
        }
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap');
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30cfd0;
            box-shadow: 0 0 20px #30cfd0;
            z-index: 100;
            width: 320px;
            backdrop-filter: blur(5px);
        }
        #controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30cfd0;
            box-shadow: 0 0 20px #30cfd0;
            z-index: 100;
            max-width: 400px;
            backdrop-filter: blur(5px);
        }
        .planet-btn {
            margin: 6px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid;
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 0 10px;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            letter-spacing: 1px;
        }
        .planet-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px;
        }
        .planet-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        #route {
            margin-top: 15px;
            padding: 10px;
            background: rgba(10, 20, 30, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(48, 207, 208, 0.3);
        }
        h1, h2 {
            margin: 5px 0;
            text-shadow: 0 0 10px #30cfd0;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
        }
        #reset {
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(150, 20, 20, 0.7);
            border: 1px solid #ff3030;
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 0 10px #ff3030;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        #reset:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ff3030;
        }
        #complete {
            margin-top: 15px;
            margin-left: 10px;
            padding: 10px 20px;
            background: rgba(20, 150, 20, 0.7);
            border: 1px solid #30ff30;
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 0 10px #30ff30;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        #complete:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #30ff30;
        }
        .glow {
            text-shadow: 0 0 10px currentColor;
        }
        .stats-value {
            color: #30cfd0;
            font-weight: bold;
            text-shadow: 0 0 5px #30cfd0;
        }
        #route-list {
            padding-left: 25px;
        }
        #route-list li {
            margin: 5px 0;
        }
        #result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        #result-content {
            background: rgba(10, 20, 30, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #30cfd0;
            box-shadow: 0 0 30px #30cfd0;
            width: 500px;
            max-width: 80%;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .result-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 0 0 15px #30cfd0;
        }
        .result-stats {
            margin: 15px 0;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
        }
        .result-label {
            text-align: left;
        }
        .result-value {
            text-align: right;
            color: #30cfd0;
            font-weight: bold;
            text-shadow: 0 0 5px #30cfd0;
        }
        #success-rate {
            font-size: 36px;
            margin: 20px 0;
            color: #30ff30;
            text-shadow: 0 0 15px #30ff30;
        }
        #close-result {
            margin-top: 20px;
            padding: 12px 25px;
            background: rgba(20, 120, 120, 0.7);
            border: 1px solid #30cfd0;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 0 15px #30cfd0;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            font-size: 16px;
            letter-spacing: 2px;
            transition: all 0.3s;
        }
        #close-result:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px #30cfd0;
        }
        #planet-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30cfd0;
            box-shadow: 0 0 20px #30cfd0;
            z-index: 100;
            max-width: 300px;
            display: none;
            backdrop-filter: blur(5px);
        }
        #planet-name {
            margin-top: 0;
            margin-bottom: 5px;
        }
        .used-path {
            opacity: 0.2;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="info">
        <h1>Logistique Spatiale</h1>
        <p>Carburant: <span id="fuel" class="stats-value">1000</span> unités</p>
        <p>Position actuelle: <span id="current-position" class="stats-value">Base Stellaire</span></p>
        <div id="route">
            <h2>Route actuelle:</h2>
            <ol id="route-list">
                <li>Base Stellaire</li>
            </ol>
        </div>
        <button id="reset">Réinitialiser</button>
        <button id="complete">Terminer la mission</button>
    </div>
    
    <div id="controls">
        <h2>Destinations disponibles:</h2>
        <div id="planet-buttons"></div>
    </div>

    <div id="planet-info">
        <h2 id="planet-name">Nom de la planète</h2>
        <p id="planet-description">Description de la planète...</p>
    </div>

    <div id="result-modal">
        <div id="result-content">
            <h2 class="result-title">Mission Accomplie!</h2>
            
            <div class="result-stats">
                <span class="result-label">Carburant utilisé:</span>
                <span id="used-fuel" class="result-value">0</span>
            </div>
            
            <div class="result-stats">
                <span class="result-label">Chemin optimal:</span>
                <span id="optimal-fuel" class="result-value">0</span>
            </div>
            
            <div class="result-stats">
                <span class="result-label">Planètes visitées:</span>
                <span id="planets-visited" class="result-value">0</span>
            </div>
            
            <h3 id="success-rate">0%</h3>
            
            <button id="close-result">CONTINUER</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Configuration du jeu
        const PLANETS = [
            { 
                name: "Base Stellaire", 
                color: 0xffffff, 
                position: new THREE.Vector3(0, 0, 0), 
                size: 8,
                description: "Point de départ et d'arrivée. Une station spatiale équipée des technologies les plus avancées."
            },
            { 
                name: "Néonova", 
                color: 0xff1493, 
                position: new THREE.Vector3(50, 5, -30), 
                size: 12,
                description: "Planète aux couleurs vives et à l'atmosphère riche en gaz nobles. Sa surface brille de mille feux."
            },
            { 
                name: "Azuron", 
                color: 0x00ffff, 
                position: new THREE.Vector3(-45, -7, -60), 
                size: 15,
                description: "Un monde océanique gelé aux profondeurs abyssales. Des cristaux bleus recouvrent sa surface."
            },
            { 
                name: "Viridia", 
                color: 0x00ff00, 
                position: new THREE.Vector3(70, -20, 40), 
                size: 18,
                description: "Planète luxuriante couverte de végétation exotique et aux écosystèmes complexes."
            },
            { 
                name: "Aurelium", 
                color: 0xffd700, 
                position: new THREE.Vector3(-65, 32, 15), 
                size: 10,
                description: "Monde minier riche en minéraux précieux. Sa surface dorée reflète la lumière des étoiles."
            },
            { 
                name: "Crimsonite", 
                color: 0xff4500, 
                position: new THREE.Vector3(30, 50, 80), 
                size: 16,
                description: "Planète volcanique en constante éruption. Sa surface est parsemée de rivières de lave ardente."
            },
            { 
                name: "Violetta", 
                color: 0x9400d3, 
                position: new THREE.Vector3(-80, -45, 65), 
                size: 14,
                description: "Monde mystérieux enveloppé d'une brume violette. Son atmosphère contient des particules énergétiques inconnues."
            }
        ];
        
        // Variables du jeu
        let fuel = 1000;
        let currentPlanetIndex = 0;
        let visitedPlanets = [0]; // Base Stellaire est le point de départ
        let visitedPaths = new Set(); // Ensemble des chemins déjà empruntés
        let scene, camera, renderer, ship, planets = [], starField = [], debris = [], pirateShips = [], paths = [];
        let targetPosition = PLANETS[0].position.clone();
        let moving = false;
        let shipRotation = 0;
        let landingMode = false;
        let landingPoint = new THREE.Vector3();
        let landingProgress = 0;
        let landingSpeed = 0.01;
        let optimalFuelUsage = 0;
        
        // Initialisation de Three.js
        function init() {
            // Création de la scène
            scene = new THREE.Scene();
            
            // Ajout d'un fond stellaire
            const spaceTexture = new THREE.CubeTextureLoader().load([
                generateSpaceBackground(),
                generateSpaceBackground(),
                generateSpaceBackground(),
                generateSpaceBackground(),
                generateSpaceBackground(),
                generateSpaceBackground()
            ]);
            scene.background = spaceTexture;
            
            // Création de la caméra
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 20, 50);
            camera.lookAt(0, 0, 0);
            
            // Création du renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            
            // Lumière ambiante
            const ambientLight = new THREE.AmbientLight(0x202020);
            scene.add(ambientLight);
            
            // Lumière directionnelle
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            // Création du vaisseau spatial
            createMillenniumFalcon();
            
            // Création des planètes
            createPlanets();
            
            // Création du champ d'étoiles
            createStarField();
            
            // Création des débris spatiaux
            createDebris();
            
            // Création des vaisseaux pirates
            createPirateShips();
            
            // Calcul du parcours optimal
            calculateOptimalRoute();
            
            // Gestionnaire de redimensionnement
            window.addEventListener('resize', onWindowResize);
            
            // Initialisation des boutons de planètes
            updatePlanetButtons();
            
            // Initialisation des boutons de réinitialisation et de fin
            document.getElementById('reset').addEventListener('click', resetGame);
            document.getElementById('complete').addEventListener('click', completeRoute);
            document.getElementById('close-result').addEventListener('click', closeResultModal);
            
            // Animation
            animate();
        }
        
        // Génération de texture pour le fond stellaire
        function generateSpaceBackground() {
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 1024;
            const ctx = canvas.getContext('2d');
            
            // Fond noir
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Étoiles
            for (let i = 0; i < 300; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const radius = Math.random() * 2;
                const opacity = Math.random() * 0.8 + 0.2;
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                ctx.fill();
                
                // Lueur pour certaines étoiles
                if (Math.random() > 0.7) {
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 4, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.3})`;
                    ctx.fill();
                }
            }
            
            // Nébuleuses
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const radius = Math.random() * 200 + 100;
                const color = Math.random() > 0.5 ? 
                    `rgba(${Math.random() * 100 + 50}, ${Math.random() * 100 + 50}, ${Math.random() * 200 + 55}, 0.1)` : 
                    `rgba(${Math.random() * 100 + 155}, ${Math.random() * 100 + 50}, ${Math.random() * 100 + 50}, 0.1)`;
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
            }
            
            return canvas.toDataURL();
        }
        
        // Création du Faucon Millennium
        function createMillenniumFalcon() {
            const shipGroup = new THREE.Group();
            
            // Corps principal (disque)
            const bodyGeometry = new THREE.CylinderGeometry(2.5, 2.5, 0.8, 16);
            const bodyMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xb0b0b0, 
                shininess: 50,
                flatShading: true
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.rotation.x = Math.PI / 2;
            shipGroup.add(body);
            
            // Cockpit (côté droit du disque)
            const cockpitGeometry = new THREE.CylinderGeometry(0.7, 0.7, 0.8, 8);
            const cockpitMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x888888, 
                shininess: 100 
            });
            const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);
            cockpit.position.set(2.2, 0, 0);
            cockpit.rotation.x = Math.PI / 2;
            shipGroup.add(cockpit);
            
            // Cockpit vitres
            const cockpitWindowGeometry = new THREE.SphereGeometry(0.5, 8, 8, 0, Math.PI);
            const cockpitWindowMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x3366ff, 
                shininess: 150,
                transparent: true,
                opacity: 0.7
            });
            const cockpitWindow = new THREE.Mesh(cockpitWindowGeometry, cockpitWindowMaterial);
            cockpitWindow.position.set(2.7, 0, 0);
            cockpitWindow.rotation.y = Math.PI / 2;
            shipGroup.add(cockpitWindow);
            
            // Mandibules (avant du vaisseau)
            const mandibleGeometry = new THREE.BoxGeometry(3, 0.8, 0.6);
            const mandibleMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xa0a0a0, 
                shininess: 50 
            });
            
            const mandibleLeft = new THREE.Mesh(mandibleGeometry, mandibleMaterial);
            mandibleLeft.position.set(0, 0, -1.5);
            shipGroup.add(mandibleLeft);
            
            const mandibleRight = new THREE.Mesh(mandibleGeometry, mandibleMaterial);
            mandibleRight.position.set(0, 0, 1.5);
            shipGroup.add(mandibleRight);
            
            // Détails sur le dessus du disque
            const detailsGeometry = new THREE.BoxGeometry(0.5, 0.3, 1);
            const detailsMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x777777, 
                shininess: 30 
            });
            
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const radius = 1.5;
                
                const detailPiece = new THREE.Mesh(detailsGeometry, detailsMaterial);
                detailPiece.position.set(
                    Math.cos(angle) * radius,
                    0.4,
                    Math.sin(angle) * radius
                );
                detailPiece.rotation.y = angle + Math.PI/2;
                shipGroup.add(detailPiece);
            }
            
            // Propulseur arrière
            const engineGeometry = new THREE.CylinderGeometry(0.8, 1, 0.5, 8);
            const engineMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x444444, 
                shininess: 80 
            });
            const engine = new THREE.Mesh(engineGeometry, engineMaterial);
            engine.position.set(-2.2, 0, 0);
            engine.rotation.z = Math.PI / 2;
            shipGroup.add(engine);
            
            // Effet de propulsion (lumière)
            const engineGlow = new THREE.PointLight(0x33aaff, 1, 8);
            engineGlow.position.set(-3, 0, 0);
            shipGroup.add(engineGlow);
            
            // Antenne parabolique sur le dessus
            const antennaBaseGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.3, 8);
            const antennaBase = new THREE.Mesh(antennaBaseGeometry, detailsMaterial);
            antennaBase.position.set(0, 0.6, 0);
            shipGroup.add(antennaBase);
            
            const antennaGeometry = new THREE.SphereGeometry(0.6, 8, 8, 0, Math.PI);
            const antenna = new THREE.Mesh(antennaGeometry, cockpitMaterial);
            antenna.position.set(0, 1, 0);
            antenna.rotation.x = Math.PI;
            shipGroup.add(antenna);
            
            ship = shipGroup;
            scene.add(ship);
            
            // Position initiale du vaisseau
            ship.position.copy(PLANETS[0].position);
            ship.position.y += PLANETS[0].size + 3; // Au-dessus de la planète
            ship.rotation.y = Math.PI / 2; // Tourné vers l'avant
        }
        
        // Création des planètes avec designs améliorés
        function createPlanets() {
            PLANETS.forEach((planetData, index) => {
                // Groupe pour la planète et ses éléments
                const planetGroup = new THREE.Group();
                
                // Géométrie de la planète de base
                const planetGeometry = new THREE.SphereGeometry(planetData.size, 64, 64);
                
                // Personnalisation selon le type de planète
                if (index === 0) { // Base Stellaire (station spatiale)
                    // Corps central
                    const centerGeometry = new THREE.SphereGeometry(planetData.size * 0.4, 32, 32);
                    const centerMaterial = new THREE.MeshPhongMaterial({
                        color: 0x888888,
                        shininess: 100,
                        emissive: 0x222222
                    });
                    const center = new THREE.Mesh(centerGeometry, centerMaterial);
                    planetGroup.add(center);
                    
                    // Anneaux
                    const ringGeometry = new THREE.TorusGeometry(planetData.size * 0.7, planetData.size * 0.08, 16, 100);
                    const ringMaterial = new THREE.MeshPhongMaterial({
                        color: 0xaaaaaa,
                        shininess: 80,
                        emissive: 0x111111
                    });
                    const ring1 = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring1.rotation.x = Math.PI / 2;
                    planetGroup.add(ring1);
                    
                    const ring2 = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring2.rotation.x = Math.PI / 4;
                    ring2.rotation.z = Math.PI / 4;
                    planetGroup.add(ring2);
                    
                    // Lumières de la station
                    for (let i = 0; i < 12; i++) {
                        const angle = (i / 12) * Math.PI * 2;
                        
                        // Sur le corps central
                        const light = new THREE.PointLight(0x3399ff, 0.5, planetData.size * 2);
                        light.position.set(
                            Math.cos(angle) * planetData.size * 0.4,
                            Math.sin(angle) * planetData.size * 0.4,
                            0
                        );
                        planetGroup.add(light);
                        
                        // Sur les anneaux
                        const lightRing = new THREE.PointLight(0xffaa00, 0.3, planetData.size);
                        lightRing.position.set(
                            Math.cos(angle) * planetData.size * 0.7,
                            0,
                            Math.sin(angle) * planetData.size * 0.7
                        );
                        planetGroup.add(lightRing);
                    }
                } 
                else if (index === 1) { // Néonova (rose fluo)
                    const planetMaterial = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        shininess: 150,
                        emissive: new THREE.Color(planetData.color).multiplyScalar(0.4),
                    });
                    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                    planetGroup.add(planet);
                    
                    // Atmosphère lumineuse
                    const atmosphereGeo = new THREE.SphereGeometry(planetData.size * 1.2, 32, 32);
                    const atmosphereMat = new THREE.MeshBasicMaterial({
                        color: planetData.color,
                        transparent: true,
                        opacity: 0.15
                    });
                    const atmosphere = new THREE.Mesh(atmosphereGeo, atmosphereMat);
                    planetGroup.add(atmosphere);
                    
                    // Rayons lumineux
                    for (let i = 0; i < 8; i++) {
                        const angle = (i / 8) * Math.PI * 2;
                        const light = new THREE.PointLight(planetData.color, 1, planetData.size * 3);
                        light.position.set(
                            Math.cos(angle) * planetData.size * 1.3,
                            Math.sin(angle) * planetData.size * 1.3,
                            0
                        );
                        planetGroup.add(light);
                    }
                }
                else if (index === 2) { // Azuron (bleu glacé)
                    const planetMaterial = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        shininess: 200,
                        emissive: new THREE.Color(planetData.color).multiplyScalar(0.2)
                    });
                    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                    planetGroup.add(planet);
                    
                    // Anneaux glacés
                    const iceRingGeometry = new THREE.TorusGeometry(planetData.size * 1.8, planetData.size * 0.15, 2, 64);
                    const iceRingMaterial = new THREE.MeshPhongMaterial({
                        color: 0xaaffff,
                        shininess: 150,
                        transparent: true,
                        opacity: 0.6
                    });
                    const iceRing = new THREE.Mesh(iceRingGeometry, iceRingMaterial);
                    iceRing.rotation.x = Math.PI / 3;
                    planetGroup.add(iceRing);
                    
                    // Lumière centrale
                    const coreLight = new THREE.PointLight(planetData.color, 1, planetData.size * 4);
                    planetGroup.add(coreLight);
                }
                else if (index === 3) { // Viridia (vert)
                    const planetMaterial = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        shininess: 50,
                        emissive: new THREE.Color(planetData.color).multiplyScalar(0.1)
                    });
                    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                    planetGroup.add(planet);
                    
                    // Atmosphère brumeuse
                    const atmGeo = new THREE.SphereGeometry(planetData.size * 1.1, 32, 32);
                    const atmMat = new THREE
